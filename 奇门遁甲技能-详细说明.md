# 奇门遁甲排盘技能 - 详细说明

## 📊 排盘方法说明

### 采用的流派和方法

我实现的是**时家奇门遁甲**（最主流的方法），具体特点：

#### 1. **置闰法**
- 按24节气分局（不是按节令）
- 阳遁期：冬至→夏至（阳遁1-9局）
- 阴遁期：夏至→冬至（阴遁9-1局）

#### 2. **局数分配**
```
阳遁（冬至-夏至）：
- 冬至、小寒、大寒 → 1局
- 立春、雨水、惊蛰 → 8局
- 春分、清明、谷雨 → 3局
- 立夏、小满、芒种 → 4局

阴遁（夏至-冬至）：
- 夏至、小暑、大暑 → 9局
- 立秋、处暑、白露 → 2局
- 秋分、寒露、霜降 → 7局
- 立冬、小雪、大雪 → 6局
```

#### 3. **拆补法**
- 中五宫寄坤二宫
- 值使门落中宫时寄坤宫处理

#### 4. **时辰转宫**
- 根据时辰地支转宫
- 阳遁：顺时针飞布
- 阴遁：逆时针飞布

#### 5. **简化处理**
⚠️ **注意**：当前版本为了简化实现，**未细分上中下元**（超神接气的精细处理）
- 标准版本：每个节气分上元、中元、下元，各5天
- 当前版本：以节气交接时刻为界直接切换局数
- **影响**：节气前后几天的排盘可能与传统手工排盘有细微差异

### 与其他流派的区别

| 特征 | 本工具（时家奇门） | 其他流派 |
|------|------------------|----------|
| 分局方法 | 置闰法（节气） | 茅山派用节令 |
| 超神接气 | 简化处理 | 有的流派细分上中下元 |
| 中宫处理 | 寄坤宫 | 有的流派寄艮宫 |
| 值符值使 | 按局数固定 | 基本一致 |
| 时辰起局 | 按地支转宫 | 基本一致 |

## 🔌 如何被阶跃 AI 调用

### ✅ 已安装成功！

技能已安装到：`/Users/gonghg/.stepfun/skills/qimen-dunjia/`

### 调用方式

#### 方式1：直接对话（推荐）

安装技能后，你可以直接和我对话：

**示例对话：**
- "帮我排个奇门遁甲盘"
- "现在是什么局？"
- "2026年2月6日晚上8点的奇门盘"
- "今天适合求财吗？"
- "明天上午10点适合签合同吗？"

我会自动：
1. 识别你的需求
2. 调用排盘脚本
3. 解读盘面
4. 给出建议

#### 方式2：命令行调用

```bash
# 排当前时间
python3 ~/.stepfun/skills/qimen-dunjia/scripts/qimen_paipan.py

# 排指定时间
python3 ~/.stepfun/skills/qimen-dunjia/scripts/qimen_paipan.py "2026-02-06 20:00"
```

#### 方式3：Python代码调用

```python
import sys
sys.path.append('/Users/gonghg/.stepfun/skills/qimen-dunjia/scripts')
from qimen_paipan import paipan
from datetime import datetime

# 排盘
result = paipan(datetime(2026, 2, 6, 20, 0))

# 获取信息
print(f"局数：{result['dun_type']}{result['ju_shu']}局")
print(f"值符：{result['zhifu']}")
print(f"值使：{result['zhishi']}")
```

## 🎯 技能触发条件

当你的对话包含以下关键词时，我会自动加载这个技能：

- 奇门遁甲、奇门、遁甲
- 排盘、起局
- 择吉、选时
- 预测、占卜
- 阴遁、阳遁
- 八门、九星、八神
- 值符、值使

## 📋 排盘信息说明

### 输出内容

每次排盘会输出：

1. **基本信息**
   - 排盘时间（公历）
   - 干支纪时（年月日时）
   - 当前节气及交接时间
   - 遁局信息（阳遁/阴遁 + 局数）
   - 值符值使

2. **九宫格局**
   ```
   巽4  离9  坤2
   震3  中5  兑7
   艮8  坎1  乾6
   ```
   
   每宫包含：
   - 天盘：三奇六仪（乙丙丁戊己庚辛壬癸）
   - 门：八门（休生伤杜景死惊开）
   - 星：九星（天蓬任冲辅英芮柱心禽）
   - 神：八神（值符螣蛇太阴六合白虎玄武九地九天）

### 如何解读

详细解读方法请参考：
```
~/.stepfun/skills/qimen-dunjia/references/qimen_theory.md
```

**快速判断：**
- **求财**：看生门所在宫位
- **求官**：看开门、值符所在宫位
- **考试**：看景门所在宫位
- **婚姻**：看六合所在宫位
- **出行**：看开门所在宫位
- **疾病**：看天心星（医）、死门（病）

**吉凶组合：**
- 吉门+吉星+吉神 = 大吉
- 凶门+凶星+凶神 = 大凶
- 其他情况需综合判断

## ⚠️ 使用注意事项

### 1. 时间准确性
- 排盘结果对时间非常敏感
- 请确保输入的时间准确（精确到分钟）
- 时间格式：`YYYY-MM-DD HH:MM`

### 2. 节气交接
- 节气交接前后3小时内，局数可能变化
- 建议避开节气交接时刻进行重要决策

### 3. 真太阳时
- **理论要求**：应使用真太阳时（考虑地理经度差异）
- **当前实现**：使用北京时间（东经120度标准时）
- **影响**：
  - 如果你在东经120度附近（如上海、杭州），影响很小
  - 如果在西部（如新疆、西藏），可能有1-2小时时差
  - 如果需要精确，需手动调整：
    ```
    真太阳时 = 北京时间 + (当地经度 - 120) × 4分钟
    ```

### 4. 流派差异
- 不同奇门流派在细节上有差异
- 本工具采用主流时家奇门规则
- 如果你学习的是其他流派，可能有细微不同

### 5. 超神接气
- 当前版本未细分上中下元
- 节气前后几天的排盘可能与传统手工盘有差异
- 如需精确，建议参考专业奇门书籍或软件

## 🔧 技术细节

### 依赖
- Python 3.6+
- 仅使用标准库（datetime, math）
- 无需安装额外包

### 算法
- 节气计算：基于天文算法（简化版）
- 干支计算：基于公历日期推算
- 九宫排布：按时家奇门规则实现

### 可扩展性
代码结构清晰，易于扩展：
- 可添加上中下元细分
- 可添加真太阳时转换
- 可添加更多格局判断
- 可添加应期推算

## 📚 学习资源

### 推荐书籍
- 《奇门遁甲统宗》- 张志春
- 《神奇之门》- 张志春
- 《奇门遁甲应用学》- 杜新会

### 在线资源
- 技能内置理论文档：`references/qimen_theory.md`
- 包含八门、九星、八神详解
- 包含格局判断和用神选择

## 🎉 开始使用

现在你可以直接和我对话，让我帮你排盘和分析了！

**试试这些：**
- "帮我排个现在的奇门盘"
- "明天早上9点适合开会吗？"
- "这周哪天适合签合同？"
- "今天的财运方位在哪？"

我会自动调用奇门遁甲技能为你分析！✨
