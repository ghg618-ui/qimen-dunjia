<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>å¥‡é—¨éç”² - æ™ºèƒ½æ’ç›˜ç³»ç»Ÿ</title>
    <!-- å¼•å…¥é«˜ç²¾åº¦å†æ³•åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap');

        body {
            background: #f5f2ed;
            font-family: "Microsoft YaHei", sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            -webkit-tap-highlight-color: transparent;
        }

        .header {
            text-align: center;
            margin-bottom: 15px;
            color: #333;
        }

        .header h1 {
            margin: 0;
            font-size: 1.4rem;
            letter-spacing: 4px;
            font-weight: normal;
            font-family: 'Ma Shan Zheng', cursive;
        }

        .main-info {
            background: #fff;
            border: 1px solid #dcd3d1;
            padding: 15px;
            width: 100%;
            max-width: 600px;
            margin-bottom: 5px;
            box-sizing: border-box;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .info-r {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            border-bottom: 1px solid #f9f6f2;
            padding-bottom: 4px;
            font-size: 0.95rem;
            align-items: center;
        }

        .lbl {
            color: #777;
            width: 65px;
            display: inline-block;
        }

        .val {
            color: #333;
            flex-grow: 1;
            text-align: left;
        }

        .kv {
            color: #c02;
            font-weight: bold;
        }

        .bazi-grid {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            text-align: center;
        }

        .bazi-col {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .bazi-lbl {
            color: #b8905b;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .bazi-val {
            font-size: 1.6rem;
            color: #d32f2f;
            font-weight: bold;
        }

        .bazi-val.green {
            color: #2e7d32;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-auto-rows: 140px;
            background: #333;
            border: 2.3px solid #333;
            gap: 1.5px;
            width: 100%;
            max-width: 600px;
            border-radius: 4px;
            overflow: hidden;
        }

        .palace-wrapper {
            position: relative;
            background: #fff;
            cursor: pointer;
            transition: background 0.2s;
        }

        .palace {
            height: 100%;
            padding: 8px;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        .p-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 33.33%;
        }

        .p-left {
            display: flex;
            align-items: center;
            white-space: nowrap;
        }

        .p-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: center;
        }

        .p-shen {
            font-size: 1.1rem;
            color: #333;
        }

        .p-xing {
            font-size: 1.15rem;
            color: #333;
        }

        .p-men {
            font-size: 1.15rem;
            color: #333;
            font-weight: bold;
        }

        .p-stem {
            font-size: 1.5rem;
            line-height: 1;
            white-space: nowrap;
            font-weight: bold;
            font-family: serif;
        }

        .p-yingan {
            color: #aaa;
            font-size: 0.9rem;
            margin-right: 2px;
        }

        .circle {
            color: #1a9c3e;
            margin-right: 2px;
            font-weight: bold;
        }

        .ma-ext {
            font-size: 1.1rem;
            color: #00bfa5;
        }

        .naji-badge {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(212, 237, 218, 0.95);
            color: #155724;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 20;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: translate(-50%, -50%) scale(1);
            }

            70% {
                transform: translate(-50%, -50%) scale(1.1);
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .bottom-nav {
            position: fixed;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            width: 92%;
            max-width: 500px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(184, 144, 91, 0.2);
            border-radius: 40px;
            display: flex;
            justify-content: space-around;
            padding: 10px 5px;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #8b7355;
            font-size: 0.7rem;
            cursor: pointer;
            flex: 1;
        }

        .nav-icon {
            font-size: 1.4rem;
            margin-bottom: 2px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background: #fff;
            margin: 15% auto;
            padding: 20px;
            border-radius: 12px;
            width: 85%;
            max-width: 450px;
            position: relative;
        }

        .close {
            float: right;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .cs-label {
            display: none;
            position: absolute;
            bottom: 100%;
            font-size: 0.65rem;
            color: #888;
            white-space: nowrap;
            margin-bottom: 4px;
        }

        body.show-cs .cs-label {
            display: block;
        }

        .action-bar {
            margin: 20px 0 100px 0;
            display: flex;
            gap: 8px;
            width: 100%;
            max-width: 600px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            background: #00bfa5;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            text-align: center;
        }

        .dt-input {
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 6px;
            flex-grow: 1;
            outline: none;
        }

        .dt-btn {
            background: #00bfa5;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 5px;
        }

        #toast {
            pointer-events: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            z-index: 20000;
            display: none;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>å¥‡é—¨éç”²</h1>
    </div>
    <div class="main-info">
        <div class="info-r" style="border-bottom: none; margin-bottom: 5px;"><span class="val"
                style="color:#b8905b; font-weight:bold;">è½¬ç›˜å¥‡é—¨ Â· å¯„å¤ Â· ç½®é—° Â· æ¼”ç¤ºç‰ˆ</span></div>
        <div class="info-r"><span class="lbl">æ—¥æœŸ</span><span class="val"
                style="display:flex; align-items:center;"><input type="datetime-local" id="custom-dt"
                    class="dt-input"><button class="dt-btn" onclick="jumpToDate()">æ’ç›˜</button></span></div>
        <div class="bazi-grid">
            <div class="bazi-col">
                <div class="bazi-lbl">å¹´æŸ±</div>
                <div class="bazi-val">--</div>
            </div>
            <div class="bazi-col">
                <div class="bazi-lbl">æœˆæŸ±</div>
                <div class="bazi-val green">--</div>
            </div>
            <div class="bazi-col">
                <div class="bazi-lbl">æ—¥æŸ±</div>
                <div class="bazi-val green">--</div>
            </div>
            <div class="bazi-col">
                <div class="bazi-lbl">æ—¶æŸ±</div>
                <div class="bazi-val">--</div>
            </div>
        </div>
        <div class="info-r"><span class="lbl">èŠ‚æ°”</span><span class="val" id="jieqi-val">--</span></div>
        <div class="info-r"><span class="lbl">å±€æ•°</span><span class="val" style="color:#666"
                id="jushu-val">--</span><span class="lbl">æ—¬é¦–</span><span class="val" style="color:#666"
                id="xunshou-val">--</span></div>
        <div class="info-r"><span class="lbl">å€¼ç¬¦</span><span class="val" style="color:#b8905b"
                id="zhifu-val">--</span><span class="lbl">å€¼ä½¿</span><span class="val" style="color:#b8905b"
                id="zhishi-val">--</span></div>
        <div class="info-r" style="border-bottom:none; margin-bottom:0;"><span class="lbl">ç©ºäº¡</span><span class="val kv"
                id="xunkong-val">--</span><span class="lbl">é©¬æ˜Ÿ</span><span class="val kv" id="yima-val">--</span></div>
    </div>
    <div class="grid" id="qimen-grid"></div>
    <div class="action-bar">
        <div class="action-btn" onclick="stepTime(-2)">â—€ ä¸Šä¸€å±€</div>
        <div class="action-btn" style="background:#6c757d" onclick="toggleCS()">é•¿ç”ŸçŠ¶æ€</div>
        <div class="action-btn" onclick="stepTime(2)">ä¸‹ä¸€å±€ â–¶</div>
    </div>
    <div class="bottom-nav">
        <div class="nav-item" onclick="resetToNow()"><span class="nav-icon">ğŸ </span><span>ç°åœ¨</span></div>
        <div class="nav-item" onclick="shareChart()"><span class="nav-icon">ğŸ“¤</span><span>åˆ†äº«</span></div>
        <div class="nav-item" id="nav-naji" onclick="toggleNaji()"><span class="nav-icon">âœ¨</span><span>çº³å‰</span></div>
        <div class="nav-item" onclick="showHelp()"><span class="nav-icon">â“</span><span>è¯´æ˜</span></div>
    </div>
    <div id="toast"></div>
    <div id="najiModal" class="modal">
        <div class="modal-content"><span class="close" onclick="closeModal('najiModal')">&times;</span>
            <div id="naji-content"></div>
        </div>
    </div>
    <div id="helpModal" class="modal">
        <div class="modal-content"><span class="close" onclick="closeModal('helpModal')">&times;</span>
            <h2 style="color:#b8905b">ä½¿ç”¨è¯´æ˜</h2>
            <p>æœ¬ç³»ç»Ÿé‡‡ç”¨ç½®é—°æ³•æ’ç›˜ï¼Œæ•°æ®è®¡ç®—ä¾èµ– lunar-javascript åº“ã€‚</p>
        </div>
    </div>
    <div id="palaceModal" class="modal">
        <div class="modal-content"><span class="close" onclick="closeModal('palaceModal')">&times;</span>
            <h3 id="palace-title" style="color:#b8905b"></h3>
            <div id="palace-content"></div>
        </div>
    </div>
    <script>
        const TIANGAN = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'], DIZHI = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'], SANQI_LIUYI = ['æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸', 'ä¸', 'ä¸™', 'ä¹™'], ZHUANPAN_ORDER = [1, 8, 3, 4, 9, 2, 7, 6], BAMEN_ORIG = { 1: 'ä¼‘é—¨', 2: 'æ­»é—¨', 3: 'ä¼¤é—¨', 4: 'æœé—¨', 6: 'å¼€é—¨', 7: 'æƒŠé—¨', 8: 'ç”Ÿé—¨', 9: 'æ™¯é—¨' }, JIUXING_ORIG = { 1: 'å¤©è“¬', 2: 'å¤©èŠ®', 3: 'å¤©å†²', 4: 'å¤©è¾…', 5: 'å¤©ç¦½', 6: 'å¤©å¿ƒ', 7: 'å¤©æŸ±', 8: 'å¤©ä»»', 9: 'å¤©è‹±' }, BASHEN = ['å€¼ç¬¦', 'è£è›‡', 'å¤ªé˜´', 'å…­åˆ', 'ç™½è™', 'ç„æ­¦', 'ä¹åœ°', 'ä¹å¤©'];
        let currentDate = new Date();
        function updateDisplay(res) {
            document.getElementById('jieqi-val').innerText = res.jqName;
            document.getElementById('jushu-val').innerText = res.dun + res.ju + "å±€(" + res.sy + ")";
            document.getElementById('xunshou-val').innerText = res.xunshou;
            document.getElementById('zhifu-val').innerText = res.zhifu;
            document.getElementById('zhishi-val').innerText = res.zhishi;
            document.getElementById('xunkong-val').innerText = res.xunkong;
            document.getElementById('yima-val').innerText = ["", "å1", "å¤2", "éœ‡3", "å·½4", "ä¸­5", "ä¹¾6", "å…‘7", "è‰®8", "ç¦»9"][res.yima];
            const bz = document.querySelectorAll('.bazi-val');
            bz[0].innerText = res.lunar.getYearInGanZhiExact(); bz[1].innerText = res.lunar.getMonthInGanZhiExact(); bz[2].innerText = res.lunar.getDayInGanZhiExact(); bz[3].innerText = res.lunar.getTimeInGanZhi();
            const grid = document.getElementById('qimen-grid'); grid.innerHTML = '';
            [4, 9, 2, 3, 5, 7, 8, 1, 6].forEach(gn => {
                const f = res.jg[gn], wrapper = document.createElement('div'); wrapper.className = 'palace-wrapper'; wrapper.onclick = () => showPalace(gn, res);
                if (gn === 5) { wrapper.innerHTML = `<div class="palace" style="justify-content:center;align-items:center;"><span class="p-stem" style="color:#666">${f.dp}</span></div>`; grid.appendChild(wrapper); return; }
                const tpT = res.marks[gn].gan_tags[f.tp] || [], dpT = res.marks[gn].gan_tags[f.dp] || [], getS = t => t.includes('å‡»åˆ‘') ? 'color:#8b00cc;font-weight:bold;' : t.includes('é—¨è¿«') ? 'color:#cc0000;font-weight:bold;' : t.includes('å…¥å¢“') ? 'color:#cc8800;font-weight:bold;' : t.includes('ç¬¦ä½¿') ? 'color:#00bfa5;font-weight:bold;' : '';
                const badge = document.createElement('div'); badge.className = 'naji-badge'; badge.style.display = 'none'; badge.innerText = 'çº³å‰'; badge.onclick = e => { e.stopPropagation(); showNaji(gn, res); }; wrapper.appendChild(badge);
                wrapper.innerHTML += `<div class="palace"><div class="p-row"><div class="p-left"><span class="p-shen">${res.xunkong.includes(DIZHI[["", 0, 7, 2, 4, 0, 10, 8, 1, 6][gn]]) ? '<span class="circle">â—‹</span>' : ''}${f.shen}</span></div><div class="p-right">${gn === res.yima ? '<span class="ma-ext">ğŸ</span>' : ''}</div></div><div class="p-row"><div class="p-left"><span class="p-yingan">${f.yingan}</span><span class="p-xing">${f.xing}</span></div><div class="p-right"><div class="stem-group"><span class="cs-label">${calcCS(f.tp, gn)}</span><span class="p-stem" style="${getS(tpT)}">${f.tp}</span></div></div></div><div class="p-row"><div class="p-left"><span class="p-men" style="${getS(res.marks[gn].tags)}">${f.men}</span></div><div class="p-right"><div class="stem-group"><span class="cs-label">${calcCS(f.dp, gn)}</span><span class="p-stem" style="${getS(dpT)}">${f.dp}</span></div></div></div></div>`; grid.appendChild(wrapper);
            });
        }
        function calcCS(g, p) { const s = { 'ç”²': 'äº¥', 'ä¹™': 'åˆ', 'ä¸™': 'å¯…', 'ä¸': 'é…‰', 'æˆŠ': 'å¯…', 'å·±': 'é…‰', 'åºš': 'å·³', 'è¾›': 'å­', 'å£¬': 'ç”³', 'ç™¸': 'å¯' }, d = { 'ç”²': 1, 'ä¹™': -1, 'ä¸™': 1, 'ä¸': -1, 'æˆŠ': 1, 'å·±': -1, 'åºš': 1, 'è¾›': -1, 'å£¬': 1, 'ç™¸': -1 }, st = ["é•¿ç”Ÿ", "æ²æµ´", "å† å¸¦", "ä¸´å®˜", "å¸æ—º", "è¡°", "ç—…", "æ­»", "å¢“", "ç»", "èƒ", "å…»"]; if (!s[g]) return ""; const t = { 1: ['å­'], 8: ['ä¸‘', 'å¯…'], 3: ['å¯'], 4: ['è¾°', 'å·³'], 9: ['åˆ'], 2: ['æœª', 'ç”³'], 7: ['é…‰'], 6: ['æˆŒ', 'äº¥'], 5: ['æœª', 'ç”³'] }[p]; const si = DIZHI.indexOf(s[g]); return t.map(z => { const ti = DIZHI.indexOf(z); return st[(d[g] === 1 ? (ti - si + 12) % 12 : (si - ti + 12) % 12)]; })[0]; }
        function paipan(date) {
            const solar = window.Solar.fromDate(date), lunar = solar.getLunar(), hg = lunar.getTimeInGanZhi(), xs = getXunShou(hg), dgan = { 'ç”²å­': 'æˆŠ', 'ç”²æˆŒ': 'å·±', 'ç”²ç”³': 'åºš', 'ç”²åˆ': 'è¾›', 'ç”²è¾°': 'å£¬', 'ç”²å¯…': 'ç™¸' }[xs];
            const prev = lunar.getPrevJieQi(), jqName = prev.getName(), jqIdx = ['å†¬è‡³', 'å°å¯’', 'å¤§å¯’', 'ç«‹æ˜¥', 'é›¨æ°´', 'æƒŠè›°', 'æ˜¥åˆ†', 'æ¸…æ˜', 'è°·é›¨', 'ç«‹å¤', 'å°æ»¡', 'èŠ’ç§', 'å¤è‡³', 'å°æš‘', 'å¤§æš‘', 'ç«‹ç§‹', 'å¤„æš‘', 'ç™½éœ²', 'ç§‹åˆ†', 'å¯’éœ²', 'éœœé™', 'ç«‹å†¬', 'å°é›ª', 'å¤§é›ª'].indexOf(jqName);
            const days = Math.floor((new Date(solar.getYear(), solar.getMonth() - 1, solar.getDay()) - new Date(1900, 0, 1)) / 86400000), sy = Math.floor(((10 + days) % 60 % 15) / 5), ju = [[1, 7, 4], [2, 8, 5], [3, 9, 6], [8, 5, 2], [9, 6, 3], [1, 7, 4], [3, 9, 6], [4, 1, 7], [5, 2, 8], [4, 1, 7], [5, 2, 8], [6, 3, 9], [9, 3, 6], [8, 2, 5], [7, 1, 4], [2, 5, 8], [1, 4, 7], [9, 3, 6], [7, 1, 4], [6, 9, 3], [5, 8, 2], [6, 9, 3], [5, 8, 2], [4, 7, 1]][jqIdx][sy];
            const dp = {};[1, 2, 3, 4, 5, 6, 7, 8, 9].forEach((g, i) => { dp[jqIdx < 12 ? [1, 2, 3, 4, 5, 6, 7, 8, 9][(order = [1, 2, 3, 4, 5, 6, 7, 8, 9].indexOf(ju) + i) % 9] : [1, 2, 3, 4, 5, 6, 7, 8, 9][([1, 2, 3, 4, 5, 6, 7, 8, 9].indexOf(ju) - i + 9) % 9]] = SANQI_LIUYI[i]; });
            const xsG = Object.keys(dp).find(k => dp[k] === dgan), xsActual = xsG == 5 ? 2 : parseInt(xsG), zhishi = BAMEN_ORIG[xsG] || 'æ­»é—¨', sg = hg[0] === 'ç”²' ? dgan : hg[0], sgG = Object.keys(dp).find(k => dp[k] === sg), sgActual = sgG == 5 ? 2 : parseInt(sgG);
            const steps = (DIZHI.indexOf(hg[1]) - DIZHI.indexOf(xs.substring(1)) + 12) % 12; let cg = parseInt(xsG); for (let i = 0; i < steps; i++)cg = jqIdx < 12 ? (cg == 9 ? 1 : cg + 1) : (cg == 1 ? 9 : cg - 1);
            const zsT = cg == 5 ? 2 : cg, getPos = g => ZHUANPAN_ORDER.indexOf(g == 5 ? 2 : g), xsP = getPos(xsActual), sgP = getPos(sgActual), zsP = getPos(zsT), jg = {};
            for (let g = 1; g <= 9; g++) {
                if (g == 5) { jg[g] = { dp: dp[5], yingan: '' }; continue; }
                const p = ZHUANPAN_ORDER.indexOf(g), xingG = ZHUANPAN_ORDER[(p - (sgP - xsP + 8) % 8 + 8) % 8], menG = ZHUANPAN_ORDER[(p - (zsP - xsP + 8) % 8 + 8) % 8];
                jg[g] = { dp: dp[g], tp: dp[xingG] || dp[5], xing: JIUXING_ORIG[xingG], men: BAMEN_ORIG[menG] || 'æ­»é—¨', shen: BASHEN[jqIdx < 12 ? (p - sgP + 8) % 8 : (sgP - p + 8) % 8] };
            }
            const yinMap = {}; for (let i = 0; i < 9; i++)yinMap[jqIdx < 12 ? (zsT + i - 1) % 9 + 1 : (zsT - i + 9 - 1) % 9 + 1] = SANQI_LIUYI[(SANQI_LIUYI.indexOf(sg) + i) % 9];
            for (let g = 1; g <= 9; g++)jg[g].yingan = yinMap[g];
            const marks = {}; for (let g = 1; g <= 9; g++) { if (g == 5) continue; const m = { tags: [], gan_tags: {} }; if (['ä¼¤é—¨', 'æœé—¨'].includes(jg[g].men) && [2, 8].includes(g)) m.tags.push('é—¨è¿«'); if (['å¼€é—¨', 'æƒŠé—¨'].includes(jg[g].men) && [3, 4].includes(g)) m.tags.push('é—¨è¿«'); if (jg[g].shen == 'å€¼ç¬¦' || jg[g].men == zhishi) m.tags.push('ç¬¦ä½¿');[jg[g].tp, jg[g].dp, jg[g].yingan].forEach(gan => { const t = []; if ({ 'å·±': [2], 'æˆŠ': [3], 'å£¬': [4], 'ç™¸': [4], 'åºš': [8], 'è¾›': [9] }[gan]?.includes(g)) t.push('å‡»åˆ‘'); if ({ 'ç”²': [2], 'ç™¸': [2], 'ä¹™': [6], 'ä¸™': [6], 'æˆŠ': [6], 'ä¸': [8], 'å·±': [8], 'åºš': [8], 'è¾›': [4], 'å£¬': [4] }[gan]?.includes(g)) t.push('å…¥å¢“'); m.gan_tags[gan] = t; }); marks[g] = m; }
            return { lunar, jg, zhifu: JIUXING_ORIG[xsG], zhishi, xunshou: xs, dun: jqIdx < 12 ? 'é˜³é' : 'é˜´é', ju, sy: ['ä¸Šå…ƒ', 'ä¸­å…ƒ', 'ä¸‹å…ƒ'][sy], jqName, xunkong: lunar.getXunKong(), yima: { 'ç”³': 8, 'å­': 8, 'è¾°': 8, 'å¯…': 2, 'åˆ': 2, 'æˆŒ': 2, 'å·³': 6, 'é…‰': 6, 'ä¸‘': 6, 'äº¥': 4, 'å¯': 4, 'æœª': 4 }[hg[1]], marks };
        }
        function getXunShou(gz) { const gi = TIANGAN.indexOf(gz[0]), zi = DIZHI.indexOf(gz[1]); return "ç”²" + DIZHI[(zi - gi + 12) % 12]; }
        function resetToNow() { currentDate = new Date(); document.getElementById('custom-dt').value = new Date(currentDate.getTime() - currentDate.getTimezoneOffset() * 60000).toISOString().substring(0, 16); updateDisplay(paipan(currentDate)); }
        function jumpToDate() { const v = document.getElementById('custom-dt').value; if (v) { currentDate = new Date(v); updateDisplay(paipan(currentDate)); } }
        function stepTime(h) { currentDate.setHours(currentDate.getHours() + h); document.getElementById('custom-dt').value = new Date(currentDate.getTime() - currentDate.getTimezoneOffset() * 60000).toISOString().substring(0, 16); updateDisplay(paipan(currentDate)); }
        function toggleCS() { document.body.classList.toggle('show-cs'); showToast(document.body.classList.contains('show-cs') ? 'å·²æ˜¾ç¤ºé•¿ç”Ÿ' : 'å·²éšè—é•¿ç”Ÿ'); }
        function toggleNaji() { const b = document.getElementById('nav-naji'); const active = b.classList.toggle('active-nj'); document.querySelectorAll('.naji-badge').forEach(i => i.style.display = active ? 'flex' : 'none'); }
        function showPalace(gn, res) { document.getElementById('palace-title').innerText = ["", "åä¸€", "å¤äºŒ", "éœ‡ä¸‰", "å·½å››", "ä¸­äº”", "ä¹¾å…­", "å…‘ä¸ƒ", "è‰®å…«", "ç¦»ä¹"][gn]; document.getElementById('palace-content').innerHTML = `<div style="line-height:2"><b>å¤©å¹²ï¼š</b>${res.jg[gn].tp}+${res.jg[gn].dp}<br><b>æ ¼å±€ï¼š</b>æ’ç›˜æ¨æ¼”ä¸­...</div>`; document.getElementById('palaceModal').style.display = 'block'; }
        function showNaji(gn, res) { document.getElementById('naji-content').innerHTML = `<h3 style="color:#28a745">çº³å‰æ–¹æ¡ˆ</h3><p>ã€é¢œè‰²ã€‘${{ "ç”²": "ç»¿", "ä¹™": "æµ…ç»¿", "ä¸™": "çº¢", "ä¸": "æµ…çº¢", "æˆŠ": "æ£•é»„", "å·±": "æµ…é»„", "åºš": "ç™½", "è¾›": "é‡‘", "å£¬": "è“é»‘", "ç™¸": "æµ…è“" }[res.jg[gn].tp]} - ${{ "ç”²": "ç»¿", "ä¹™": "æµ…ç»¿", "ä¸™": "çº¢", "ä¸": "æµ…çº¢", "æˆŠ": "æ£•é»„", "å·±": "æµ…é»„", "åºš": "ç™½", "è¾›": "é‡‘", "å£¬": "è“é»‘", "ç™¸": "æµ…è“" }[res.jg[gn].dp]}</p>`; document.getElementById('najiModal').style.display = 'block'; }
        function showToast(m) { const t = document.getElementById('toast'); t.innerText = m; t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 2000); }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function shareChart() { showToast('ç”Ÿæˆåˆ†äº«å›¾ä¸­...'); html2canvas(document.body).then(c => { const k = document.createElement('a'); k.download = 'å¥‡é—¨_' + Date.now() + '.png'; k.href = c.toDataURL(); k.click(); }); }
        window.onload = () => { setTimeout(resetToNow, 200); };
    </script>
</body>

</html>