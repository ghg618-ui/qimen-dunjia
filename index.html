<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Â•áÈó®ÈÅÅÁî≤ - Êô∫ËÉΩÊéíÁõòÁ≥ªÁªü</title>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap');

        body {
            background: #f5f2ed;
            font-family: "Microsoft YaHei", sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            -webkit-tap-highlight-color: transparent;
        }

        .header {
            text-align: center;
            margin-bottom: 15px;
            color: #333;
        }

        .header h1 {
            margin: 0;
            font-size: 1.4rem;
            letter-spacing: 4px;
            font-weight: normal;
            font-family: 'Ma Shan Zheng', cursive;
        }

        .main-info {
            background: #fff;
            border: 1px solid #dcd3d1;
            padding: 15px;
            width: 100%;
            max-width: 600px;
            margin-bottom: 5px;
            box-sizing: border-box;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .info-r {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            border-bottom: 1px solid #f9f6f2;
            padding-bottom: 4px;
            font-size: 0.95rem;
            align-items: center;
        }

        .lbl {
            color: #777;
            width: 65px;
            display: inline-block;
        }

        .val {
            color: #333;
            flex-grow: 1;
            text-align: left;
        }

        .kv {
            color: #c02;
            font-weight: bold;
        }

        .bazi-grid {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            text-align: center;
        }

        .bazi-col {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .bazi-lbl {
            color: #b8905b;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .bazi-val {
            font-size: 1.6rem;
            color: #d32f2f;
            font-weight: bold;
        }

        .bazi-val.green {
            color: #2e7d32;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-auto-rows: 140px;
            background: #333;
            border: 2.3px solid #333;
            gap: 1.5px;
            width: 100%;
            max-width: 600px;
            border-radius: 4px;
            overflow: hidden;
        }

        .palace-wrapper {
            position: relative;
            background: #fff;
            cursor: pointer;
            transition: background 0.2s;
        }

        .palace {
            height: 100%;
            padding: 8px;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        .p-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 33.33%;
        }

        .p-left {
            display: flex;
            align-items: center;
            white-space: nowrap;
        }

        .p-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: center;
        }

        .p-shen {
            font-size: 1.1rem;
            color: #333;
        }

        .p-xing {
            font-size: 1.15rem;
            color: #333;
        }

        .p-men {
            font-size: 1.15rem;
            color: #333;
            font-weight: bold;
        }

        .p-stem {
            font-size: 1.5rem;
            line-height: 1;
            white-space: nowrap;
            font-weight: bold;
            font-family: serif;
        }

        .p-yingan {
            color: #aaa;
            font-size: 0.9rem;
            margin-right: 2px;
        }

        .circle {
            color: #1a9c3e;
            margin-right: 2px;
            font-weight: bold;
        }

        .ma-ext {
            font-size: 1.1rem;
            color: #00bfa5;
        }

        .naji-badge {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(212, 237, 218, 0.95);
            color: #155724;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 20;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: translate(-50%, -50%) scale(1);
            }

            70% {
                transform: translate(-50%, -50%) scale(1.1);
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .bottom-nav {
            position: fixed;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            width: 92%;
            max-width: 500px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(184, 144, 91, 0.2);
            border-radius: 40px;
            display: flex;
            justify-content: space-around;
            padding: 10px 5px;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #8b7355;
            font-size: 0.7rem;
            cursor: pointer;
            flex: 1;
        }

        .nav-icon {
            font-size: 1.4rem;
            margin-bottom: 2px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background: #fff;
            margin: 15% auto;
            padding: 20px;
            border-radius: 12px;
            width: 85%;
            max-width: 450px;
            position: relative;
        }

        .close {
            float: right;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .cs-label {
            display: none;
            position: absolute;
            bottom: 100%;
            font-size: 0.65rem;
            color: #888;
            white-space: nowrap;
            margin-bottom: 4px;
        }

        body.show-cs .cs-label {
            display: block;
        }

        .action-bar {
            margin: 20px 0 100px 0;
            display: flex;
            gap: 8px;
            width: 100%;
            max-width: 600px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            background: #00bfa5;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            text-align: center;
        }

        .dt-input {
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 6px;
            flex-grow: 1;
            outline: none;
        }

        .dt-btn {
            background: #00bfa5;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 5px;
        }

        #toast {
            pointer-events: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            z-index: 20000;
            display: none;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>Â•áÈó®ÈÅÅÁî≤</h1>
    </div>
    <div class="main-info">
        <div class="info-r" style="border-bottom: none; margin-bottom: 5px;"><span class="val"
                style="color:#b8905b; font-weight:bold;">ËΩ¨ÁõòÂ•áÈó® ¬∑ ÂØÑÂù§ ¬∑ ÁΩÆÈó∞ ¬∑ Á®≥ÂÆöÁâà</span></div>
        <div class="info-r"><span class="lbl">Êó•Êúü</span><span class="val"
                style="display:flex; align-items:center;"><input type="datetime-local" id="custom-dt"
                    class="dt-input"><button class="dt-btn" onclick="jumpToDate()">ÊéíÁõò</button></span></div>
        <div class="bazi-grid">
            <div class="bazi-col">
                <div class="bazi-lbl">Âπ¥Êü±</div>
                <div class="bazi-val">--</div>
            </div>
            <div class="bazi-col">
                <div class="bazi-lbl">ÊúàÊü±</div>
                <div class="bazi-val green">--</div>
            </div>
            <div class="bazi-col">
                <div class="bazi-lbl">Êó•Êü±</div>
                <div class="bazi-val green">--</div>
            </div>
            <div class="bazi-col">
                <div class="bazi-lbl">Êó∂Êü±</div>
                <div class="bazi-val">--</div>
            </div>
        </div>
        <div class="info-r"><span class="lbl">ËäÇÊ∞î</span><span class="val" id="jieqi-val">--</span></div>
        <div class="info-r"><span class="lbl">Â±ÄÊï∞</span><span class="val" style="color:#666"
                id="jushu-val">--</span><span class="lbl">Êó¨È¶ñ</span><span class="val" style="color:#666"
                id="xunshou-val">--</span></div>
        <div class="info-r"><span class="lbl">ÂÄºÁ¨¶</span><span class="val" style="color:#b8905b"
                id="zhifu-val">--</span><span class="lbl">ÂÄº‰Ωø</span><span class="val" style="color:#b8905b"
                id="zhishi-val">--</span></div>
        <div class="info-r" style="border-bottom:none; margin-bottom:0;"><span class="lbl">Á©∫‰∫°</span><span class="val kv"
                id="xunkong-val">--</span><span class="lbl">È©¨Êòü</span><span class="val kv" id="yima-val">--</span></div>
    </div>
    <div class="grid" id="qimen-grid"></div>
    <div class="action-bar">
        <div class="action-btn" onclick="stepTime(-2)">‚óÄ ‰∏ä‰∏ÄÂ±Ä</div>
        <div class="action-btn" style="background:#6c757d" onclick="toggleCS()">ÈïøÁîüÁä∂ÊÄÅ</div>
        <div class="action-btn" onclick="stepTime(2)">‰∏ã‰∏ÄÂ±Ä ‚ñ∂</div>
    </div>
    <div class="bottom-nav">
        <div class="nav-item" onclick="resetToNow()"><span class="nav-icon">üè†</span><span>Áé∞Âú®</span></div>
        <div class="nav-item" onclick="shareChart()"><span class="nav-icon">üì§</span><span>ÂàÜ‰∫´</span></div>
        <div class="nav-item" id="nav-naji" onclick="toggleNaji()"><span class="nav-icon">‚ú®</span><span>Á∫≥Âêâ</span></div>
        <div class="nav-item" onclick="showHelp()"><span class="nav-icon">‚ùì</span><span>ËØ¥Êòé</span></div>
    </div>
    <div id="toast"></div>
    <div id="najiModal" class="modal">
        <div class="modal-content"><span class="close" onclick="closeModal('najiModal')">&times;</span>
            <div id="naji-content"></div>
        </div>
    </div>
    <div id="helpModal" class="modal">
        <div class="modal-content"><span class="close" onclick="closeModal('helpModal')">&times;</span>
            <h2 style="color:#b8905b">‰ΩøÁî®ËØ¥Êòé</h2>
            <p>Êú¨Á≥ªÁªüÈááÁî®ÁΩÆÈó∞Ê≥ïÊéíÁõòÔºåÊé•Âè£Â∑≤‰øÆÂ§ç„ÄÇ</p>
        </div>
    </div>
    <div id="palaceModal" class="modal">
        <div class="modal-content"><span class="close" onclick="closeModal('palaceModal')">&times;</span>
            <h3 id="palace-title" style="color:#b8905b"></h3>
            <div id="palace-content"></div>
        </div>
    </div>
    <script>
        const T = ['Áî≤', '‰πô', '‰∏ô', '‰∏Å', 'Êàä', 'Â∑±', 'Â∫ö', 'Ëæõ', 'Â£¨', 'Áô∏'], D = ['Â≠ê', '‰∏ë', 'ÂØÖ', 'ÂçØ', 'Ëæ∞', 'Â∑≥', 'Âçà', 'Êú™', 'Áî≥', 'ÈÖâ', 'Êàå', '‰∫•'], SQ = ['Êàä', 'Â∑±', 'Â∫ö', 'Ëæõ', 'Â£¨', 'Áô∏', '‰∏Å', '‰∏ô', '‰πô'], ZO = [1, 8, 3, 4, 9, 2, 7, 6], BO = { 1: '‰ºëÈó®', 2: 'Ê≠ªÈó®', 3: '‰º§Èó®', 4: 'ÊùúÈó®', 6: 'ÂºÄÈó®', 7: 'ÊÉäÈó®', 8: 'ÁîüÈó®', 9: 'ÊôØÈó®' }, XO = { 1: 'Â§©Ëì¨', 2: 'Â§©ËäÆ', 3: 'Â§©ÂÜ≤', 4: 'Â§©ËæÖ', 5: 'Â§©Á¶Ω', 6: 'Â§©ÂøÉ', 7: 'Â§©Êü±', 8: 'Â§©‰ªª', 9: 'Â§©Ëã±' }, BS = ['ÂÄºÁ¨¶', 'Ëû£Ëõá', 'Â§™Èò¥', 'ÂÖ≠Âêà', 'ÁôΩËôé', 'ÁéÑÊ≠¶', '‰πùÂú∞', '‰πùÂ§©'];
        let curD = new Date();
        function updateUI(r) {
            document.getElementById('jieqi-val').innerText = r.jq;
            document.getElementById('jushu-val').innerText = r.du + r.ju + "Â±Ä(" + r.sy + ")";
            document.getElementById('xunshou-val').innerText = r.xs;
            document.getElementById('zhifu-val').innerText = r.zf;
            document.getElementById('zhishi-val').innerText = r.zs;
            document.getElementById('xunkong-val').innerText = r.xk;
            document.getElementById('yima-val').innerText = ["", "Âùé1", "Âù§2", "Èúá3", "Â∑Ω4", "‰∏≠5", "‰πæ6", "ÂÖë7", "ËâÆ8", "Á¶ª9"][r.ym];
            const bz = document.querySelectorAll('.bazi-val');
            bz[0].innerText = r.lu.getYearInGanZhiExact(); bz[1].innerText = r.lu.getMonthInGanZhiExact(); bz[2].innerText = r.lu.getDayInGanZhiExact(); bz[3].innerText = r.lu.getTimeInGanZhi();
            const g = document.getElementById('qimen-grid'); g.innerHTML = '';
            [4, 9, 2, 3, 5, 7, 8, 1, 6].forEach(n => {
                const f = r.jg[n], w = document.createElement('div'); w.className = 'palace-wrapper'; w.onclick = () => showP(n, r);
                if (n === 5) { w.innerHTML = `<div class="palace" style="justify-content:center;align-items:center;"><span class="p-stem" style="color:#666">${f.dp}</span></div>`; g.appendChild(w); return; }
                const tpT = r.mk[n].gt[f.tp] || [], dpT = r.mk[n].gt[f.dp] || [], getS = t => t.includes('ÂáªÂàë') ? 'color:#8b00cc;font-weight:bold;' : t.includes('Èó®Ëø´') ? 'color:#cc0000;font-weight:bold;' : t.includes('ÂÖ•Â¢ì') ? 'color:#cc8800;font-weight:bold;' : t.includes('Á¨¶‰Ωø') ? 'color:#00bfa5;font-weight:bold;' : '';
                w.innerHTML = `<div class="naji-badge" style="display:none">Á∫≥Âêâ</div><div class="palace"><div class="p-row"><div class="p-left"><span class="p-shen">${r.xk.includes(D[["", 0, 7, 2, 4, 0, 10, 8, 1, 6][n]]) ? '<span class="circle">‚óã</span>' : ''}${f.sn}</span></div><div class="p-right">${n === r.ym ? '<span class="ma-ext">üêé</span>' : ''}</div></div><div class="p-row"><div class="p-left"><span class="p-yingan">${f.yg}</span><span class="p-xing">${f.xi}</span></div><div class="p-right"><div class="stem-group"><span class="cs-label">${calcCS(f.tp, n)}</span><span class="p-stem" style="${getS(tpT)}">${f.tp}</span></div></div></div><div class="p-row"><div class="p-left"><span class="p-men" style="${getS(r.mk[n].ts)}">${f.me}</span></div><div class="p-right"><div class="stem-group"><span class="cs-label">${calcCS(f.dp, n)}</span><span class="p-stem" style="${getS(dpT)}">${f.dp}</span></div></div></div></div>`;
                const b = w.querySelector('.naji-badge'); b.onclick = e => { e.stopPropagation(); showN(n, r); };
                g.appendChild(w);
            });
        }
        function calcCS(g, p) { const s = { 'Áî≤': '‰∫•', '‰πô': 'Âçà', '‰∏ô': 'ÂØÖ', '‰∏Å': 'ÈÖâ', 'Êàä': 'ÂØÖ', 'Â∑±': 'ÈÖâ', 'Â∫ö': 'Â∑≥', 'Ëæõ': 'Â≠ê', 'Â£¨': 'Áî≥', 'Áô∏': 'ÂçØ' }, d = { 'Áî≤': 1, '‰πô': -1, '‰∏ô': 1, '‰∏Å': -1, 'Êàä': 1, 'Â∑±': -1, 'Â∫ö': 1, 'Ëæõ': -1, 'Â£¨': 1, 'Áô∏': -1 }, st = ["ÈïøÁîü", "Ê≤êÊµ¥", "ÂÜ†Â∏¶", "‰∏¥ÂÆò", "Â∏ùÊó∫", "Ë°∞", "ÁóÖ", "Ê≠ª", "Â¢ì", "Áªù", "ËÉé", "ÂÖª"]; if (!s[g]) return ""; const t = { 1: ['Â≠ê'], 8: ['‰∏ë', 'ÂØÖ'], 3: ['ÂçØ'], 4: ['Ëæ∞', 'Â∑≥'], 9: ['Âçà'], 2: ['Êú™', 'Áî≥'], 7: ['ÈÖâ'], 6: ['Êàå', '‰∫•'], 5: ['Êú™', 'Áî≥'] }[p]; const si = D.indexOf(s[g]); const ti = D.indexOf(t[0]); return st[(d[g] === 1 ? (ti - si + 12) % 12 : (si - ti + 12) % 12)]; }
        function paipan(date) {
            try {
                const sol = window.Solar.fromDate(date), lun = sol.getLunar(), hg = lun.getTimeInGanZhi(), xs = getXS(hg), dg = { 'Áî≤Â≠ê': 'Êàä', 'Áî≤Êàå': 'Â∑±', 'Áî≤Áî≥': 'Â∫ö', 'Áî≤Âçà': 'Ëæõ', 'Áî≤Ëæ∞': 'Â£¨', 'Áî≤ÂØÖ': 'Áô∏' }[xs];
                const jn = lun.getPrevJieQi().getName(), ji = ['ÂÜ¨Ëá≥', 'Â∞èÂØí', 'Â§ßÂØí', 'Á´ãÊò•', 'Èõ®Ê∞¥', 'ÊÉäËõ∞', 'Êò•ÂàÜ', 'Ê∏ÖÊòé', 'Ë∞∑Èõ®', 'Á´ãÂ§è', 'Â∞èÊª°', 'ËäíÁßç', 'Â§èËá≥', 'Â∞èÊöë', 'Â§ßÊöë', 'Á´ãÁßã', 'Â§ÑÊöë', 'ÁôΩÈú≤', 'ÁßãÂàÜ', 'ÂØíÈú≤', 'ÈúúÈôç', 'Á´ãÂÜ¨', 'Â∞èÈõ™', 'Â§ßÈõ™'].indexOf(jn);
                const dayOrder = (10 + Math.floor((new Date(sol.getYear(), sol.getMonth() - 1, sol.getDay()) - new Date(1900, 0, 1)) / 86400000)) % 60, sy = Math.floor((dayOrder % 15) / 5), ju = [[1, 7, 4], [2, 8, 5], [3, 9, 6], [8, 5, 2], [9, 6, 3], [1, 7, 4], [3, 9, 6], [4, 1, 7], [5, 2, 8], [4, 1, 7], [5, 2, 8], [6, 3, 9], [9, 3, 6], [8, 2, 5], [7, 1, 4], [2, 5, 8], [1, 4, 7], [9, 3, 6], [7, 1, 4], [6, 9, 3], [5, 8, 2], [6, 9, 3], [5, 8, 2], [4, 7, 1]][ji][sy];
                const dp = {};[1, 2, 3, 4, 5, 6, 7, 8, 9].forEach((g, i) => { dp[ji < 12 ? [1, 2, 3, 4, 5, 6, 7, 8, 9][([1, 2, 3, 4, 5, 6, 7, 8, 9].indexOf(ju) + i) % 9] : [1, 2, 3, 4, 5, 6, 7, 8, 9][([1, 2, 3, 4, 5, 6, 7, 8, 9].indexOf(ju) - i + 9) % 9]] = SQ[i]; });
                const xg = Object.keys(dp).find(k => dp[k] === dg), xa = xg == 5 ? 2 : parseInt(xg), zs = BO[xg] || 'Ê≠ªÈó®', sg = hg[0] === 'Áî≤' ? dg : hg[0], sgG = Object.keys(dp).find(k => dp[k] === sg), sa = sgG == 5 ? 2 : parseInt(sgG);
                const st = (D.indexOf(hg[1]) - D.indexOf(xs.substring(1)) + 12) % 12; let cg = parseInt(xg); for (let i = 0; i < st; i++)cg = ji < 12 ? (cg == 9 ? 1 : cg + 1) : (cg == 1 ? 9 : cg - 1);
                const zt = cg == 5 ? 2 : cg, get = (g) => ZO.indexOf(g == 5 ? 2 : g), xp = get(xa), sp = get(sa), zp = get(zt), jg = {};
                for (let n = 1; n <= 9; n++) {
                    if (n == 5) { jg[n] = { dp: dp[5], yg: '' }; continue; }
                    const p = ZO.indexOf(n), xiG = ZO[(p - (sp - xp + 8) % 8 + 8) % 8], meG = ZO[(p - (zp - xp + 8) % 8 + 8) % 8];
                    jg[n] = { dp: dp[n], tp: dp[xiG] || dp[5], xi: XO[xiG], me: BO[meG] || 'Ê≠ªÈó®', sn: BS[ji < 12 ? (p - sp + 8) % 8 : (sp - p + 8) % 8] };
                }
                const ym = {}; for (let i = 0; i < 9; i++)ym[ji < 12 ? (zt + i - 1) % 9 + 1 : (zt - i + 9 - 1) % 9 + 1] = SQ[(SQ.indexOf(sg) + i) % 9];
                for (let n = 1; n <= 9; n++)jg[n].yg = ym[n];
                const mk = {}; for (let n = 1; n <= 9; n++) { if (n == 5) continue; const m = { ts: [], gt: {} }; if (['‰º§Èó®', 'ÊùúÈó®'].includes(jg[n].me) && [2, 8].includes(n)) m.ts.push('Èó®Ëø´'); if (['ÂºÄÈó®', 'ÊÉäÈó®'].includes(jg[n].me) && [3, 4].includes(n)) m.ts.push('Èó®Ëø´');[jg[n].tp, jg[n].dp, jg[n].yg].forEach(gan => { const t = []; if ({ 'Â∑±': [2], 'Êàä': [3], 'Â£¨': [4], 'Áô∏': [4], 'Â∫ö': [8], 'Ëæõ': [9] }[gan]?.includes(n)) t.push('ÂáªÂàë'); if ({ 'Áî≤': [2], 'Áô∏': [2], '‰πô': [6], '‰∏ô': [6], 'Êàä': [6], '‰∏Å': [8], 'Â∑±': [8], 'Â∫ö': [8], 'Ëæõ': [4], 'Â£¨': [4] }[gan]?.includes(n)) t.push('ÂÖ•Â¢ì'); m.gt[gan] = t; }); mk[n] = m; }
                const xkStr = lun.getEightChar().getDayXunKong(); // GitHub compatible API
                return { lu: lun, jg, zf: XO[xa], zs, xs, du: ji < 12 ? 'Èò≥ÈÅÅ' : 'Èò¥ÈÅÅ', ju, sy: ['‰∏äÂÖÉ', '‰∏≠ÂÖÉ', '‰∏ãÂÖÉ'][sy], jq: jn, xk: xkStr, ym: { 'Áî≥': 8, 'Â≠ê': 8, 'Ëæ∞': 8, 'ÂØÖ': 2, 'Âçà': 2, 'Êàå': 2, 'Â∑≥': 6, 'ÈÖâ': 6, '‰∏ë': 6, '‰∫•': 4, 'ÂçØ': 4, 'Êú™': 4 }[hg[1]], mk };
            } catch (e) { console.error("PAIPAN ERROR:", e); return null; }
        }
        function getXS(gz) { const gi = T.indexOf(gz[0]), zi = D.indexOf(gz[1]); return "Áî≤" + D[(zi - gi + 12) % 12]; }
        function resetToNow() { curD = new Date(); document.getElementById('custom-dt').value = new Date(curD.getTime() - curD.getTimezoneOffset() * 60000).toISOString().substring(0, 16); const r = paipan(curD); if (r) updateUI(r); }
        function jumpToDate() { const v = document.getElementById('custom-dt').value; if (v) { curD = new Date(v); const r = paipan(curD); if (r) updateUI(r); } }
        function stepTime(h) { curD.setHours(curD.getHours() + h); document.getElementById('custom-dt').value = new Date(curD.getTime() - curD.getTimezoneOffset() * 60000).toISOString().substring(0, 16); const r = paipan(curD); if (r) updateUI(r); }
        function toggleCS() { document.body.classList.toggle('show-cs'); showToast(document.body.classList.contains('show-cs') ? 'Â∑≤ÂºÄÂêØÈïøÁîü' : 'Â∑≤ÂÖ≥Èó≠ÈïøÁîü'); }
        function toggleNaji() { const b = document.getElementById('nav-naji'); const a = b.classList.toggle('active-nj'); document.querySelectorAll('.naji-badge').forEach(i => i.style.display = a ? 'flex' : 'none'); }
        function showP(n, r) { document.getElementById('palace-title').innerText = ["", "Âùé‰∏Ä", "Âù§‰∫å", "Èúá‰∏â", "Â∑ΩÂõõ", "‰∏≠‰∫î", "‰πæÂÖ≠", "ÂÖë‰∏É", "ËâÆÂÖ´", "Á¶ª‰πù"][n]; document.getElementById('palace-content').innerHTML = `Ê†ºÂ±ÄÊé®Êºî‰∏≠...`; document.getElementById('palaceModal').style.display = 'block'; }
        function showN(n, r) { document.getElementById('naji-content').innerHTML = `Á∫≥ÂêâÊñπÊ°à...`; document.getElementById('najiModal').style.display = 'block'; }
        function showToast(m) { const t = document.getElementById('toast'); t.innerText = m; t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 2000); }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function shareChart() { showToast('ÁîüÊàêÂõæ‰∏≠...'); html2canvas(document.body).then(c => { const l = document.createElement('a'); l.download = 'Qimen.png'; l.href = c.toDataURL(); l.click(); }); }
        window.onload = () => { setTimeout(resetToNow, 500); };
    </script>
</body>

</html>